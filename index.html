<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Symbiotic Runner</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #0f0; /* neon green */
      background: rgba(0, 255, 0, 0.2); /* faded neon green */
      font-family: Arial, sans-serif;
    }

    #gameCanvas {
      display: block;
      margin: 0 auto;
      background: transparent;
    }

    #ui {
      position: fixed;
      top: 10px;
      width: 100%;
      text-align: center;
      color: black;
      font-size: 24px;
      font-weight: bold;
      z-index: 2;
    }

    #usernameInput {
      margin-top: 10px;
      padding: 5px;
      font-size: 16px;
    }

    #startBtn {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="ui">
    <div id="usernameContainer">
      Enter Username: <input type="text" id="usernameInput" placeholder="Your name">
      <button id="startBtn">Start Game</button>
    </div>
    <div id="scoreContainer" style="display:none;">
      <div id="score">Score: 0</div>
      <div id="highScore">High Score: 0</div>
    </div>
  </div>
  <canvas id="gameCanvas" width="800" height="400"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const startBtn = document.getElementById("startBtn");
    const usernameInput = document.getElementById("usernameInput");
    const usernameContainer = document.getElementById("usernameContainer");
    const scoreContainer = document.getElementById("scoreContainer");
    const scoreDisplay = document.getElementById("score");
    const highScoreDisplay = document.getElementById("highScore");

    let player, obstacles, score, highScore, gameOver, gameStarted, username;

    class Player {
      constructor() {
        this.x = 50;
        this.y = 300;
        this.width = 30;
        this.height = 30;
        this.color = "black";
        this.dy = 0;
        this.gravity = 0.6;
        this.jumpPower = -12;
        this.grounded = false;
      }

      draw() {
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
      }

      update() {
        this.y += this.dy;
        if (this.y + this.height < canvas.height) {
          this.dy += this.gravity;
          this.grounded = false;
        } else {
          this.y = canvas.height - this.height;
          this.dy = 0;
          this.grounded = true;
        }
        this.draw();
      }

      jump() {
        if (this.grounded) {
          this.dy = this.jumpPower;
        }
      }
    }

    class Obstacle {
      constructor(type, speed) {
        this.type = type;
        this.speed = speed;
        this.x = canvas.width;
        this.y = type === "ground" ? canvas.height - 30 : canvas.height - 150;
        this.width = type === "ground" ? 30 : 25;
        this.height = type === "ground" ? 30 : 25;
      }

      draw() {
        ctx.fillStyle = "black";
        if (this.type === "ground") {
          ctx.fillRect(this.x, this.y, this.width, this.height);
        } else {
          // Flying obstacle as an "S" shape
          ctx.strokeStyle = "#0f0";
          ctx.lineWidth = 3;
          ctx.beginPath();
          ctx.moveTo(this.x, this.y);
          ctx.bezierCurveTo(this.x + 10, this.y - 15, this.x + 15, this.y + 15, this.x + 25, this.y);
          ctx.stroke();
        }
      }

      update() {
        this.x -= this.speed;
        this.draw();
      }
    }

    function startGame() {
      if (!usernameInput.value.trim()) {
        alert("Please enter a username!");
        return;
      }
      username = usernameInput.value.trim();
      usernameContainer.style.display = "none";
      scoreContainer.style.display = "block";

      player = new Player();
      obstacles = [];
      score = 0;
      highScore = localStorage.getItem(username + "_highScore") || 0;
      highScoreDisplay.textContent = `High Score: ${highScore}`;
      gameOver = false;
      gameStarted = true;

      requestAnimationFrame(updateGame);
    }

    function updateGame() {
      if (!gameStarted) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      player.update();

      // Spawn obstacles
      if (Math.random() < 0.02 + score * 0.0001) {
        let type = score < 50 ? "ground" : (Math.random() < 0.5 ? "ground" : "flying");
        let speed = 4 + score * 0.01;
        obstacles.push(new Obstacle(type, speed));
      }

      obstacles.forEach((obs, index) => {
        obs.update();

        if (obs.x + obs.width < 0) {
          obstacles.splice(index, 1);
          score++;
          scoreDisplay.textContent = `Score: ${score}`;
        }

        // Collision detection
        if (
          player.x < obs.x + obs.width &&
          player.x + player.width > obs.x &&
          player.y < obs.y + obs.height &&
          player.y + player.height > obs.y
        ) {
          gameOver = true;
          gameStarted = false;
          if (score > highScore) {
            highScore = score;
            localStorage.setItem(username + "_highScore", highScore);
          }
          highScoreDisplay.textContent = `High Score: ${highScore}`;
          alert(`Game Over, ${username}! Your score: ${score}`);
          usernameContainer.style.display = "block";
          scoreContainer.style.display = "none";
        }
      });

      if (!gameOver) requestAnimationFrame(updateGame);
    }

    document.addEventListener("keydown", (e) => {
      if (e.code === "Space") {
        player.jump();
      }
    });

    startBtn.addEventListener("click", startGame);
  </script>
</body>
</html>
