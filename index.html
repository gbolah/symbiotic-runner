<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Symbiotic Runner</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: Arial, sans-serif;
      background: #adff2f; /* faded neon green */
    }

    header {
      background: rgba(0, 0, 0, 0.8);
      color: #00ff00;
      padding: 20px;
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 10;
    }

    #gameCanvas {
      display: block;
      background: transparent;
      margin: 0;
      position: absolute;
      top: 80px;
      left: 0;
    }

    #ui {
      position: fixed;
      top: 80px;
      right: 20px;
      background: rgba(0,0,0,0.6);
      padding: 10px;
      border-radius: 10px;
      color: #fff;
      font-size: 16px;
    }

    #usernameInput {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.9);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      color: #fff;
      z-index: 20;
    }

    button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: #00ff00;
      cursor: pointer;
    }

    button:hover {
      background: #33ff33;
    }
  </style>
</head>
<body>
  <header>Symbiotic Runner</header>

  <canvas id="gameCanvas"></canvas>

  <div id="ui" style="display:none;">
    <p>Score: <span id="score">0</span></p>
    <p>High Score: <span id="highScore">0</span></p>
    <button id="restartBtn">Restart</button>
  </div>

  <div id="usernameInput">
    <h2>Enter Username</h2>
    <input type="text" id="username" placeholder="Your name">
    <br>
    <button id="startBtn">Start Game</button>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight - 80; // below header

    const ui = document.getElementById("ui");
    const scoreEl = document.getElementById("score");
    const highScoreEl = document.getElementById("highScore");
    const restartBtn = document.getElementById("restartBtn");
    const usernameInputDiv = document.getElementById("usernameInput");
    const startBtn = document.getElementById("startBtn");
    const usernameField = document.getElementById("username");

    let username = "";
    let highScores = JSON.parse(localStorage.getItem("symbioticRunnerHighScores")) || {};

    let player = { x: 50, y: 0, width: 20, height: 20, dy: 0, gravity: 0.6, jumpPower: -12, grounded: false };
    let obstacles = [];
    let frame = 0;
    let score = 0;
    let highScore = 0;
    let gameRunning = false;

    function drawPlayer() {
      ctx.fillStyle = "#00FF00";
      ctx.font = "bold 20px Arial";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText("S", player.x + player.width / 2, player.y + player.height / 2);
    }

    function drawObstacles() {
      ctx.fillStyle = "black";
      obstacles.forEach(o => ctx.fillRect(o.x, o.y, o.width, o.height));
    }

    function updatePlayer() {
      player.dy += player.gravity;
      player.y += player.dy;

      if (player.y + player.height >= canvas.height) {
        player.y = canvas.height - player.height;
        player.dy = 0;
        player.grounded = true;
      }
    }

    function updateObstacles() {
      obstacles.forEach(o => o.x -= 5);
      obstacles = obstacles.filter(o => o.x + o.width > 0);

      // Obstacle spawn logic
      if (frame % (score < 20 ? 120 : 60) === 0) {
        let height = 40;
        obstacles.push({ x: canvas.width, y: canvas.height - height, width: 20, height });
      }
    }

    function detectCollision() {
      return obstacles.some(o =>
        player.x < o.x + o.width &&
        player.x + player.width > o.x &&
        player.y < o.y + o.height &&
        player.y + player.height > o.y
      );
    }

    function updateScore() {
      score++;
      scoreEl.textContent = score;

      if (score > highScore) {
        highScore = score;
        highScoreEl.textContent = highScore;
        highScores[username] = highScore;
        localStorage.setItem("symbioticRunnerHighScores", JSON.stringify(highScores));
      }
    }

    function gameLoop() {
      if (!gameRunning) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      updatePlayer();
      updateObstacles();
      drawPlayer();
      drawObstacles();
      updateScore();

      if (detectCollision()) {
        gameRunning = false;
        restartBtn.style.display = "block";
      } else {
        frame++;
        requestAnimationFrame(gameLoop);
      }
    }

    function startGame() {
      username = usernameField.value.trim() || "Player";
      usernameInputDiv.style.display = "none";
      ui.style.display = "block";

      highScore = highScores[username] || 0;
      highScoreEl.textContent = highScore;

      resetGame();
    }

    function resetGame() {
      player.y = canvas.height - player.height;
      player.dy = 0;
      obstacles = [];
      score = 0;
      frame = 0;
      scoreEl.textContent = score;
      restartBtn.style.display = "none";
      gameRunning = true;
      gameLoop();
    }

    // Controls
    document.addEventListener("keydown", (e) => {
      if ((e.code === "Space" || e.code === "ArrowUp") && player.grounded) {
        player.dy = player.jumpPower;
        player.grounded = false;
      }
    });

    restartBtn.addEventListener("click", resetGame);
    startBtn.addEventListener("click", startGame);

    window.addEventListener("resize", () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight - 80;
    });
  </script>
</body>
</html>
